import csv
import numpy as np

names = {}
retweet_names = {}

#with open("N2_full_data.txt", 'r') as n1:
#    for line in n1.readlines():
#        line = line.split(",")
#        names[line[0]] = True

total = 0
active = 0
num_in_degree_0 = 0
num_out_degree_0 = 0

tweet_id = "1117354119650598912"

# with open("N2_trust_feature_data.txt", 'r') as file:
#     for line in file.readlines():
#         line = line.split(",")
#         if (line[0] in names): raise Exception("dupe")

#         names[line[0]] = int(line[2]) + int(line[3])
#         if (int(line[2]) == 0 and line[1] == "1"):
#             num_out_degree_0 += 1

#         if (int(line[3]) == 0 and line[1] == "1"):
#             num_in_degree_0 += 1

#         if (line[1] == "1"): 
#             active +=1
#             names[line[0]] = (line[2], line[3])
#         total += 1

# print("total", total, "active", active, "num_in_degree_0", num_in_degree_0, "num_out_0", num_out_degree_0)

with open(f"retweets_{tweet_id}.txt", 'r') as file:
    for line in file.readlines():
        line = line.split(",")

        retweet_names[line[2]] = line[1]

# with open("retweets_1116612649972719617.txt", 'r') as file:
#     for line in file.readlines():
#         line = line.split(",")

#         retweet_names[line[2]] = line[1]

print("num in retweets", len(retweet_names), len(set(retweet_names.keys())))

nbr = []

with open(f"clean_network_{tweet_id}_R.txt", 'r') as net:
    clean_names = {}

    total = 0
    count = 0

    for line in net.readlines():
        total += 1
        line = line.strip()
        line = line.split(",")

        if (line[0] in retweet_names):
            if (line[0] in clean_names):
                clean_names[line[0]].append(line[1])
            else:
                clean_names[line[0]] = [line[1]]
        else:
            count += 1
    
    print(total, count)
        
    
    print("len clean names", len(clean_names.keys()))
    print("len retweet names", len(retweet_names.keys()))
    count = 0

    

# with open(f"clean_network_{tweet_id}_R.txt", 'r') as net:
#     clean_names = {}

#     for line in net.readlines():
#         line = line.strip()
#         line = line.split(",")

#         if (line[0] in names):
#             if (line[0] in clean_names):
#                 clean_names[line[0]].append(line[1])
#             else:
#                 clean_names[line[0]] = [line[1]]
        
    
#     print("len clean names", len(clean_names.keys()))
#     print("len names", len(names.keys()))
#     print("len retweet names", len(retweet_names.keys()))
#     count = 0
        
#     for name in retweet_names:
#         if (name not in clean_names): 
#             count+= 1
#             continue

#         l = sorted(clean_names[name], key=lambda x: 0 if names[x] == 0 else int(names[x][1]))

#         if (len(l) == 0):
#             print(name)
#             raise Exception (name, " has no neighbors")

#         l = l[len(l)-50:len(l)]

#         print(l)
#         raise Exception

#         for i, username in enumerate(l):
#             if (username in retweet_names):
#                 l[i] = int(retweet_names[username])
#                 print(l[i])
#             else:
#                 print(username)
#                 raise Exception

#         l += [0] * (50 - len(l)) # pad with zeroes if 
#         nbr.append(np.array(l))
    
#     print("count", count)

nbr = np.array(nbr)
np.save("nbr.npy", nbr)